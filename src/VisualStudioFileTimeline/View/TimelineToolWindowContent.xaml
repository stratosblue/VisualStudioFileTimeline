<DataTemplate xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
              xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
              xmlns:vs="http://schemas.microsoft.com/visualstudio/extensibility/2022/xaml"
              xmlns:styles="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.15.0"
              xmlns:colors="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Shell.15.0"
              xmlns:viewmodels="clr-namespace:VisualStudioFileTimeline.ViewModel;assembly=VisualStudioFileTimeline"
              xmlns:converters="clr-namespace:VisualStudioFileTimeline.Converters;assembly=VisualStudioFileTimeline"
              xmlns:core="clr-namespace:VisualStudioFileTimeline;assembly=VisualStudioFileTimeline.Core"
              DataType="{x:Type viewmodels:TimelineToolWindowViewModel}">
  <!-- 引用的命名空间必须要指定 assembly , 且对应的程序集必须强签名 -->

  <Grid>
    <Grid.Resources>

      <Style TargetType="ListView" BasedOn="{StaticResource {x:Static styles:VsResourceKeys.ThemedDialogListViewStyleKey}}" />
      <Style TargetType="Label" BasedOn="{StaticResource {x:Static styles:VsResourceKeys.ThemedDialogLabelStyleKey}}" />
      <Style TargetType="TextBox" BasedOn="{StaticResource {x:Static styles:VsResourceKeys.TextBoxStyleKey}}" />
      <Style TargetType="Button" BasedOn="{StaticResource {x:Static styles:VsResourceKeys.ButtonStyleKey}}" />
      <Style TargetType="TextBlock">
        <Setter Property="Foreground" Value="{DynamicResource {x:Static styles:VsBrushes.WindowTextKey}}" />
      </Style>

      <converters:TimeDisplayConverter x:Key="TimeDisplayConverter" />
    </Grid.Resources>

    <Grid.ColumnDefinitions>
      <ColumnDefinition />
    </Grid.ColumnDefinitions>

    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition />
    </Grid.RowDefinitions>

    <Border BorderThickness="1">
      <TextBlock Text="{Binding FileName}"
                 TextTrimming="CharacterEllipsis"
                 TextWrapping="NoWrap" />
    </Border>
    <ListView Grid.Row="1"
              ItemsSource="{Binding Items, Mode=OneWay}"
		          SelectionMode="Single">
      <ListView.Resources>
        <Style TargetType="ScrollViewer">
          <Setter Property="HorizontalScrollBarVisibility" Value="Disabled" />
        </Style>
      </ListView.Resources>

      <ListView.ItemContainerStyle>
        <Style TargetType="ListViewItem">
          <Setter Property="HorizontalContentAlignment" Value="Stretch" />
          <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
        </Style>
      </ListView.ItemContainerStyle>

      <ListView.ItemTemplate>
        <DataTemplate DataType="{x:Type viewmodels:TimelineItemViewModel}">
          <Grid Margin="8,0">

            <Grid.ToolTip>
              <ToolTip Style="{DynamicResource {x:Static styles:VsResourceKeys.LargeToolTipStyleKey}}">
                <StackPanel>
                  <TextBlock Text="{Binding Time}" />
                  <TextBlock Text="{Binding Title}" FontWeight="Bold" />
                </StackPanel>
              </ToolTip>
            </Grid.ToolTip>

            <Grid.ContextMenu>
              <ContextMenu Style="{DynamicResource {x:Static styles:VsResourceKeys.ContextMenuStyleKey}}">

                <!--TODO 功能按钮应当由提供者提供-->

                <!--<MenuItem Header="与当前进行比较"></MenuItem>
                <MenuItem Header="与上一个版本比较"></MenuItem>
                <Separator />
                <MenuItem Header="作为对比基线" Command="{Binding SelectAsComparisonBaseLineCommand}"></MenuItem>
                <Separator />-->
                <MenuItem Header="{x:Static core:Resources.MenuItem_Header_ViewContent}" Command="{Binding ViewContentCommand}" CommandParameter="{Binding}">
                  <MenuItem.Icon>
                    <vs:Image Source="KnownMonikers.OpenFile" />
                  </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="{x:Static core:Resources.MenuItem_Header_RestoreContent}" Command="{Binding RestoreContentCommand}" CommandParameter="{Binding}">
                  <MenuItem.Icon>
                    <vs:Image Source="KnownMonikers.RestoreSnapshot" />
                  </MenuItem.Icon>
                </MenuItem>
                <Separator />
                <MenuItem Header="{x:Static core:Resources.MenuItem_Header_OpenWithExplorer}" Command="{Binding OpenWithExplorerCommand}" CommandParameter="{Binding}">
                  <MenuItem.Icon>
                    <vs:Image Source="KnownMonikers.OpenFolder" />
                  </MenuItem.Icon>
                </MenuItem>
                <Separator />
                <!--<MenuItem Header="重命名"></MenuItem>-->
                <MenuItem Header="{x:Static core:Resources.MenuItem_Header_Delete}" Command="{Binding DeleteCommand}" CommandParameter="{Binding}">
                  <MenuItem.Icon>
                    <vs:Image Source="KnownMonikers.Delete" />
                  </MenuItem.Icon>
                </MenuItem>
              </ContextMenu>
            </Grid.ContextMenu>

            <Grid.ColumnDefinitions>
              <ColumnDefinition />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock Text="{Binding Title, Mode=OneWay}"
                       TextTrimming="CharacterEllipsis"
                       TextWrapping="NoWrap" />

            <TextBlock Grid.Column="1"
					             Text="{Binding Time, Mode=OneWay, Converter={StaticResource TimeDisplayConverter}}"
                       Opacity="0.7"
                       HorizontalAlignment="Right" />
          </Grid>
        </DataTemplate>
      </ListView.ItemTemplate>
    </ListView>
  </Grid>
</DataTemplate>
