<UserControl x:Class="VisualStudioFileTimeline.View.TimelineToolWindowControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vs="http://schemas.microsoft.com/visualstudio/extensibility/2022/xaml"
             xmlns:catalog="clr-namespace:Microsoft.VisualStudio.Imaging;assembly=Microsoft.VisualStudio.ImageCatalog"
             xmlns:imaging="clr-namespace:Microsoft.VisualStudio.Imaging;assembly=Microsoft.VisualStudio.Imaging"
             xmlns:styles="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.15.0"
             xmlns:converters="clr-namespace:VisualStudioFileTimeline.Converters"
             xmlns:viewmodels="clr-namespace:VisualStudioFileTimeline.ViewModel"
             xmlns:core="clr-namespace:VisualStudioFileTimeline;assembly=VisualStudioFileTimeline.Core"
             mc:Ignorable="d"
             d:DesignHeight="400" d:DesignWidth="300"
             d:DataContext="{d:DesignInstance Type=viewmodels:TimelineToolWindowViewModel}">
  <!-- 引用的命名空间必须要指定 assembly , 且对应的程序集必须强签名 -->
  <!--xmlns:vs="http://schemas.microsoft.com/visualstudio/extensibility/2022/xaml" 直接导致设计器无法打开-->

  <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
    <Grid.Resources>

      <Style TargetType="ListView" BasedOn="{StaticResource {x:Static styles:VsResourceKeys.ThemedDialogListViewStyleKey}}" />
      <Style TargetType="Label" BasedOn="{StaticResource {x:Static styles:VsResourceKeys.ThemedDialogLabelStyleKey}}" />
      <Style TargetType="TextBox" BasedOn="{StaticResource {x:Static styles:VsResourceKeys.TextBoxStyleKey}}" />
      <Style TargetType="Button" BasedOn="{StaticResource {x:Static styles:VsResourceKeys.ButtonStyleKey}}" />
      <Style TargetType="TextBlock">
        <Setter Property="Foreground" Value="{DynamicResource {x:Static styles:VsBrushes.WindowTextKey}}" />
      </Style>

      <converters:TimeDisplayConverter x:Key="TimeDisplayConverter" />
      <converters:Int32ToVisibilityConverter x:Key="Int32ToVisibilityConverter" />
      <converters:SourceControlNameImageMonikerConverter x:Key="SourceControlNameImageMonikerConverter" />
    </Grid.Resources>

    <Grid.ColumnDefinitions>
      <ColumnDefinition />
    </Grid.ColumnDefinitions>

    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition />
    </Grid.RowDefinitions>

    <!--Title-->
    <Border BorderThickness="0,0,0,1"
            BorderBrush="{DynamicResource {x:Static styles:VsBrushes.InactiveBorderKey}}">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <TextBlock Text="{Binding FileName}"
                   TextTrimming="CharacterEllipsis"
                   TextWrapping="NoWrap"
                   Margin="8,1" />
      </Grid>
    </Border>
    <!--Title-->

    <!--Content-->
    <Grid Grid.Row="1">

      <!--Tips-->
      <Grid Visibility="{Binding Items.Count, Converter={StaticResource Int32ToVisibilityConverter}, ConverterParameter=0}"
            HorizontalAlignment="Center"
            VerticalAlignment="Center">
        <TextBlock Text="{x:Static core:Resources.View_Tips_NoHistoryNow}" />
      </Grid>
      <!--Tips-->

      <!--History List-->
      <ListView Visibility="{Binding Items.Count, Converter={StaticResource Int32ToVisibilityConverter}}"
                ItemsSource="{Binding Items, Mode=OneWay}"
		            SelectionMode="Single"
                BorderThickness="0">
        <ListView.Resources>
          <Style TargetType="ScrollViewer">
            <Setter Property="HorizontalScrollBarVisibility" Value="Disabled" />
          </Style>
        </ListView.Resources>

        <ListView.ItemContainerStyle>
          <Style TargetType="ListViewItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
          </Style>
        </ListView.ItemContainerStyle>

        <ListView.ItemTemplate>
          <DataTemplate DataType="{x:Type viewmodels:TimelineItemViewModel}">
            <Grid Margin="0,0,8,0">

              <Grid.ToolTip>
                <ToolTip Style="{DynamicResource {x:Static styles:VsResourceKeys.LargeToolTipStyleKey}}">
                  <StackPanel>
                    <TextBlock Text="{Binding Time}" />
                    <TextBlock Text="{Binding Title}" FontWeight="Bold" />
                    <TextBlock Text="{Binding Description}" />
                  </StackPanel>
                </ToolTip>
              </Grid.ToolTip>

              <Grid.ContextMenu>
                <ContextMenu Style="{DynamicResource {x:Static styles:VsResourceKeys.ContextMenuStyleKey}}">
                  <!--TODO 功能按钮应当由提供者提供-->

                  <!--<MenuItem Header="与当前进行比较"></MenuItem>
                <MenuItem Header="与上一个版本比较"></MenuItem>
                <Separator />
                <MenuItem Header="作为对比基线" Command="{Binding SelectAsComparisonBaseLineCommand}"></MenuItem>
                <Separator />-->
                  <MenuItem Header="{x:Static core:Resources.MenuItem_Header_ViewContent}" Command="{Binding ViewContentCommand}" CommandParameter="{Binding}">
                    <MenuItem.Icon>
                      <imaging:CrispImage Moniker="{x:Static catalog:KnownMonikers.OpenFile}" />
                    </MenuItem.Icon>
                  </MenuItem>
                  <MenuItem Header="{x:Static core:Resources.MenuItem_Header_RestoreContent}" Command="{Binding RestoreContentCommand}" CommandParameter="{Binding}">
                    <MenuItem.Icon>
                      <imaging:CrispImage Moniker="{x:Static catalog:KnownMonikers.RestoreSnapshot}" />
                    </MenuItem.Icon>
                  </MenuItem>
                  <Separator />
                  <MenuItem Header="{x:Static core:Resources.MenuItem_Header_OpenWithExplorer}" Command="{Binding OpenWithExplorerCommand}" CommandParameter="{Binding}">
                    <MenuItem.Icon>
                      <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                        <imaging:CrispImage Moniker="{x:Static catalog:KnownMonikers.OpenFolder}" />
                      </Grid>
                    </MenuItem.Icon>
                  </MenuItem>
                  <Separator />
                  <!--<MenuItem Header="重命名"></MenuItem>-->
                  <MenuItem Header="{x:Static core:Resources.MenuItem_Header_Delete}" Command="{Binding DeleteCommand}" CommandParameter="{Binding}">
                    <MenuItem.Icon>
                      <imaging:CrispImage Moniker="{x:Static catalog:KnownMonikers.Delete}" />
                    </MenuItem.Icon>
                  </MenuItem>
                </ContextMenu>
              </Grid.ContextMenu>

              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>

              <imaging:CrispImage VerticalAlignment="Center"
                                  HorizontalAlignment="Center"
                                  Margin="0,0,4,0"
                                  Width="16"
                                  Height="16"
                                  Moniker="{Binding SourceControlName, Converter={StaticResource SourceControlNameImageMonikerConverter}}" />

              <TextBlock Grid.Column="1"
                         Text="{Binding Title, Mode=OneWay}"
                         TextTrimming="CharacterEllipsis"
                         TextWrapping="NoWrap" />

              <TextBlock Grid.Column="2"
					               Text="{Binding Time, Mode=OneWay, Converter={StaticResource TimeDisplayConverter}}"
                         Opacity="0.7"
                         HorizontalAlignment="Right" />
            </Grid>
          </DataTemplate>
        </ListView.ItemTemplate>
      </ListView>
      <!--History List-->
    </Grid>
    <!--Content-->
  </Grid>
</UserControl>
